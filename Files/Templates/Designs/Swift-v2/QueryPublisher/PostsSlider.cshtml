@inherits Dynamicweb.Rendering.ViewModelTemplate<Dynamicweb.QueryPublisher.QueryResultViewModel>
@using Dynamicweb.Core.Encoders
@using Dynamicweb
@using Dynamicweb.Frontend

@if (Model.Results.Count() > 0)
{
	AddStylesheet("/Files/Templates/Designs/Swift-v2/Assets/lib/swiffy-slider/dist/css/swiffy-slider.min.css");
	AddScript("/Files/Templates/Designs/Swift-v2/Assets/lib/swiffy-slider/dist/js/swiffy-slider.min.js");

	<div id="Slider_@Pageview.CurrentParagraph.ID" class="
		swiffy-slider  
		slider-item-reveal  
		slider-nav-round 
		slider-nav-sm
		slider-nav-page 
		slider-indicators-sm
		slider-indicators-round 
		slider-indicators-outside">
		
		<ul class="slider-container pb-4" style="--swiffy-slider-item-width: min(calc(100% - var(--swiffy-slider-item-reveal)), 25rem);">
			@foreach (var post in Model.Results)
			{
				if (post.TryGetValue("PageId", out object? pageId) && pageId is int) {			
					var pageInfo = Dynamicweb.Frontend.ContentViewModelFactory.CreatePageInfoViewModel(Dynamicweb.Content.Services.Pages?.GetPage((int)pageId));

					<li>
						<a href="/Default.aspx?ID=@pageInfo.ID" class="card shadow h-100" style="min-height:25rem;">
							<figure class="m-0">
								<img class="card-img-top" src="https://placehold.co/600x400" title="@pageInfo.Name">                            
							</figure>
							<div class="card-body d-flex flex-column justify-content-between">
								<div data-swift-text class="mb-0-last-child">
									<h5 class="card-title">@pageInfo.Name</h5>
									<small class="opacity-75">@pageInfo.UpdatedDate</small>	
									<p class="card-text">
										@pageInfo.Description
									</p>
								</div>
							</div>
						</a>
					</li>
				}
			}
		</ul>

		<button type="button" title="@Translate("Previous slide")" class="slider-nav" style="z-index:1;">
			<span class="visually-hidden">@Translate("Previous slide")</span>
		</button>
		<button type="button" title="@Translate("Next slide")" class="slider-nav slider-nav-next" style="z-index:1;">
			<span class="visually-hidden">@Translate("Next slide")</span>
		</button>
		
		<ul class="slider-indicators mb-2">
			@for (int slideCount = 1; Model.Results.Count() >= slideCount; slideCount++)
			{
				<li title='@Translate("Go to slide") @slideCount'>
					<span class="visually-hidden">@Translate("Go to slide") @slideCount</span>
				</li>
			}
		</ul>
	</div>

	<script>
		window.swiffyslider.initSlider(document.querySelector('#Slider_@Pageview.CurrentParagraph.ID'));
	</script>
}

