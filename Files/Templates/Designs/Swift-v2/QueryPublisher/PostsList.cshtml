@inherits Dynamicweb.Rendering.ViewModelTemplate<Dynamicweb.QueryPublisher.QueryResultViewModel>
@using Dynamicweb.Core.Encoders
@using Dynamicweb
@using Dynamicweb.Frontend

@{
	string searchTerm = Dynamicweb.Context.Current.Request.QueryString.Get("postq") ?? string.Empty;
}

<div class="grid type-ahead-dropdown position-relative mb-4">
	<div class="g-col-12 g-col-lg-8">
		<h2 class="h4 mb-0">@Translate("Posts")</h2>
	</div>
	<div class="g-col-12 g-col-lg-4">
		<form method="get" class="suggest-form">
			<div class="d-flex align-items-center mb-3">
				<label for="postsSearch_@Pageview.CurrentParagraph.ID" class="visually-hidden">@Translate("Search for posts")</label>
				<span class="position-absolute icon-2 reset-search px-3">
					@ReadFile("/Files/Images/Icons/magnifying-glass.svg")
				</span>
				<input id="postsSearch_@Pageview.CurrentParagraph.ID"
						type="search"
						class="form-control form-control-sm rounded-pill type-ahead-field py-2 ps-5 pe-5"
						placeholder="@Translate("Search for posts")"
						aria-label="@Translate("Search for posts")"
						aria-describedby="postsSearch_@Pageview.CurrentParagraph.ID"
						name="postq"
						value="@searchTerm">

				<button type="button"
						onclick="var f = document.getElementById('postsSearch_@Pageview.CurrentParagraph.ID'); f.value = ''; f.focus(); f.closest('form').submit();"
						class="btn position-absolute end-0 icon-2 reset-search"
						aria-label="@Translate("Clear search field")"
						style="opacity: 0; visibility: hidden;">
					@ReadFile("/Files/Images/Icons/xmark.svg")
				</button>
			</div>
		</form>
	</div>
</div>

@if (Model.Results.Count() > 0)
{
	<div class="grid gap-3">
		@foreach (var post in Model.Results)
		{
			if (post.TryGetValue("PageId", out object? pageId) && pageId is int) {			
				var pageInfo = Dynamicweb.Frontend.ContentViewModelFactory.CreatePageInfoViewModel(Dynamicweb.Content.Services.Pages?.GetPage((int)pageId));

				if (pageInfo != null)
				{		
					<a href="/Default.aspx?ID=@pageInfo.ID" class="card g-col-6 g-col-lg-3 text-decoration-none">
						<img src="https://placehold.co/600x400" class="card-img-top" alt="@pageInfo.Name">
						<div class="card-body">
							<h5 class="card-title">
								@pageInfo.Name
							</h5>
							<small class="opacity-75">@pageInfo.UpdatedDate</small>	
							<p class="card-text">
								@pageInfo.Description
							</p>
						</div>		
					</a>
				}
			}
		}
	</div>
}
else
{
	<div class="alert alert-dark w-100 text-center" role="alert">
		@Translate("No posts found")
	</div>
}


