@inherits ViewModelTemplate<SavedCardListViewModel>
@using Dynamicweb.Rendering
@using Dynamicweb.Ecommerce.Frontend.SavedCards

@{
    var paragraphId = Pageview?.CurrentParagraph?.ID.ToString() ?? "0";
    var cards       = Model.SavedCardList;
}

<div class="h-100" data-dw-colorscheme="@Pageview.CurrentParagraph?.ColorSchemeId">
    <header class="d-flex flex-row align-items-center gap-3 px-2 py-3 border-bottom">
        <h1 class="h6 m-0 flex-fill">@Pageview.CurrentParagraph?.Item?["Title"]</h1>
    </header>

    @if (cards.Any())
    {
        <table class="table table-striped table-hover table-linked align-top mb-0">
            <thead>
                <tr>
                    <th>@Translate("Card")</th>
                    <th>@Translate("Brand")</th>
                    <th>@Translate("Identifier")</th>
                    <th>@Translate("Default")</th>
                    <th class="text-end">@Translate("Actions")</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var c in cards)
            {
                var id = c.ID;
                var type = c.CardType;
                var identifier = c.Identifier;
                var isDefault = c.IsDefault;

                var detailsUrl = $"/?ID={Pageview.Page.ID}&SavedCardId={id}";

                <tr onclick="location.href='@detailsUrl'" style="cursor:pointer">
                    <td><a href="@detailsUrl" class="text-decoration-none">@id</a></td>
                    <td><a href="@detailsUrl" class="text-decoration-none">@type</a></td>
                    <td><a href="@detailsUrl" class="text-decoration-none">@identifier</a></td>
                    <td>
                        @if (isDefault) { <span class="badge bg-success">@Translate("Default")</span> }
                    </td>
                    <td class="text-end">
                        @if (!isDefault)
                        {
                            <form method="post" class="d-inline me-1">
                                <input type="hidden" name="SavedCardId" value="@id" />
                                <button type="submit"
                                        name="SavedCardCmd"
                                        value="CardSetAsDefault"
                                        class="btn btn-sm btn-outline-primary">
                                    @Translate("Set as default")
                                </button>
                            </form>
                        }

                        <form method="post" class="d-inline" onsubmit="return confirm('@Translate("Delete this saved card?")');">
                            <input type="hidden" name="SavedCardId" value="@id" />
                            <button type="submit"
                                    name="SavedCardCmd"
                                    value="CardDelete"
                                    class="btn btn-sm btn-outline-danger">
                                @Translate("Delete")
                            </button>
                        </form>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    }
    else
    {
        <div class="alert alert-info m-3">
            @Translate("No saved cards found.")
        </div>
    }
</div>
