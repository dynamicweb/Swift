@inherits Dynamicweb.Rendering.RazorTemplateBase<Dynamicweb.Rendering.RazorTemplateModel<Dynamicweb.Rendering.Template>>
@{
	var invoiceList = GetLoop("Ecom:IntegrationCustomerCenter.InvoiceLoop");
	string shopId = Pageview.Area.EcomShopId != null ? Pageview.Area.EcomShopId : string.Empty;
}

<div class="card overflow-hidden">
    <div class="table-responsive" style="margin-bottom:-1px;" >
        <table class="table table-md table-hover mb-0 align-middle fs-7" style="--bs-table-color: var(--bs-body-color);" hx-swap-oob="true outerHTML:[data-swift-order-list]" data-swift-order-list>
            <thead style="--bs-table-bg: rgba(var(--bs-body-color-rgb), .0275); --bs-table-color: rgba(var(--bs-body-color-rgb), 0.5);">
				<tr>
					<th>@Translate("Order number")</th>
					<th>@Translate("Placed")</th>
					<th class="text-end">@Translate("Total")</th>
					<th>&nbsp;</th>
				</tr>
			</thead>
			<tbody>
				@foreach (LoopItem credit in invoiceList)
				{
					var currency = Dynamicweb.Ecommerce.Services.Currencies.GetCurrency(credit.GetString("CurrencyCode")) ?? Dynamicweb.Ecommerce.Common.Context.Currency;
					string price = new PriceInfo(currency) { PriceWithoutVAT = credit.GetDouble("totalAmountIncVat") }.PriceWithoutVATFormatted;
					string orderDate = !string.IsNullOrEmpty(credit.GetString("orderDate")) ? credit.GetDate("orderDate").TimeOfDay.Ticks > 0 ? credit.GetDate("orderDate").ToString(Dynamicweb.Core.Helpers.DateHelper.DateOnlyFormatStringMedium) : credit.GetDate("orderDate").ToShortDateString() : "";
					string orderId = credit.GetString("id");

					<tr class="position-relative">
						<td>
							<a href="@GetString("Ecom:IntegrationCustomerCenter.Invoice.Link")&itemID=@orderId" class="border-0 btn btn-outline-secondary btn-sm py-2 px-3 position-relative z-2" data-dw-button="outline-secondary"  title="@Translate("View order")">@Translate("No.") @orderId</a>
						</td>
						<td>@orderDate</td>
						<td class="text-end">@price</td>
						<td>
							<div class="hstack gap-3">
								<button class="btn btn-outline-secondary text-body hstack border-0 p-2 position-relative z-2 ms-auto" data-dw-button="outline-secondary" type="button" data-bs-toggle="dropdown" aria-expanded="false">
									<span class="icon-2">
										@ReadFile("/Files/Images/Icons/ellipsis.svg")
									</span>
								</button>
								<ul class="dropdown-menu shadow-sm fs-7">
									<li>
										<a class="dropdown-item hstack gap-2" href="@GetString("Ecom:IntegrationCustomerCenter.Invoice.Link")&itemID=@orderId">
											<span class="icon-2">
												@ReadFile("/Files/Images/Icons/eye.svg")
											</span>
											@Translate("View")
										</a>
									</li>
									<li>
										<a class="dropdown-item hstack gap-2" href="/Admin/public/CustomerCenter/RequestExternalPdf.aspx?type=Invoice&id=@(orderId)&forceDownload=true&shopid=@(shopId)">
											<span class="icon-2">
												@ReadFile("/Files/Images/Icons/download.svg")
											</span>
											@Translate("Download PDF")
										</a>
									</li>
								</ul>
							</div>
						</td>
					</tr>
				}

				@if( invoiceList.Count() < 1 )
				{
					<tr class="position-relative">
						<td colspan="8">
							<div class="d-grid py-4">
								<span class="m-auto">
									<div class="d-grid rounded-circle m-auto" style="width:4rem;aspect-ratio:1;background-color:rgba(var(--bs-body-color-rgb), .0275);">
										<span class="icon-4 text-body text-opacity-50">
											@ReadFile("/Files/Images/Icons/file-contract.svg")
										</span>
									</div>
									<div class="mt-3">@Translate("No invoices found")</div>
								</span>
							</div>
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
</div>

@if (!string.IsNullOrWhiteSpace(GetString("Ecom:IntegrationCustomerCenter.Invoice.Paging.Show")))
{
	@Include("CustomerCenterPagination.cshtml")
}