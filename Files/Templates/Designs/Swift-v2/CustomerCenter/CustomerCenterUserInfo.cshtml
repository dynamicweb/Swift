@inherits Dynamicweb.Rendering.ViewModelTemplate<UserViewModel>
@using Dynamicweb.Frontend
@using Dynamicweb.Security.UserManagement

@if (Model?.ID != null)
{
    <div class="vstack align-items-center justify-content-center p-3 position-relative border-bottom">
        <a href="@(!string.IsNullOrEmpty(SearchEngineFriendlyURLs.GetFriendlyUrl(GetPageIdByNavigationTag("CustomerCenter"))) ? SearchEngineFriendlyURLs.GetFriendlyUrl(GetPageIdByNavigationTag("CustomerCenter")) : string.Empty )" class="stretched-link"></a>

        @if(Model.TryGetImageFile(out ImageFileViewModel? image))
        {
            <div class="align-self-auto hstack justify-content-center p-0" style="height:4rem; aspect-ratio:1;">
                <img src="@image.ToGetImage(new(){ Width = 60, Ratio = "1/1" })" alt="@Model.Name" class="img-thumbnail rounded-circle" itemprop="image"/>
            </div>
        }
        else 
        {
            <div class="btn btn-primary rounded-circle align-self-auto hstack justify-content-center p-0" style="height:4rem; aspect-ratio:1;" data-dw-button="primary">
                <div class="d-flex dw-h6 lh-1 m-0">
                    @(Model.GetTwoLetterInitials())
                </div>
            </div>
        }

        <h5 class="h6 mb-0 text-center mt-2">
            @((!string.IsNullOrEmpty(Model?.FirstName) && !string.IsNullOrEmpty(Model?.LastName)) ? $"<span>{Model.FirstName}</span> <span>{Model.LastName}</span>" : Model?.Name)
        </h5>
        
        @{
            bool canImpersonate = UserContext.Current.GetImpersonatableUsers()?.Count() > 0;
            var currentImpersonatingUser = UserContext.Current.ImpersonatingUser;
            
            if (canImpersonate && currentImpersonatingUser is not null)
            {
                <a href="Default.aspx?ID=@(Pageview.ID)&DwExtranetRemoveSecondaryUser=1" class="btn btn-outline-secondary hstack fs-8 py-2 px-3 z-2 mx-auto mt-2" data-dw-button="outline-secondary">
                    <span class="icon-2 me-2">@ReadFile("/Files/Images/Icons/arrows-repeat.svg")</span>
                    <span>
                        @Translate("Switch back to") @(currentImpersonatingUser?.Name)
                    </span>
                </a>
            }
        }

    </div>
}